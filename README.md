# gbif-taxonomy-for-la

Utilities to adapt the [GBIF Backbone Taxonomy](https://www.gbif.org/dataset/d7dddbf4-2cf0-4f39-9b2a-bb099caae36c) for it usage by LA portals.

## Introduction

This is a set of utilities to convert the GBIF Backbone Taxonony for it usage by LA portals. This consist in:

- Download the current GBIB backbone taxonomy and some dependencies 
- Separate `scientificName` and `scientificNameAuthorship` from `Taxon.txv`
- Detect issues during this convertion that can be reported back to GBIF (see `target/backbone/issues.tsv`).
- Workaround for some issues in the taxonomy that prevent the nameindexer to work properly.
- Generate lucene 6 and lucene 8 indexes for us by LA portals (for nameindexer, namematching-service and sensitive-data-service)
- Generate the modified dwca for bie-index

The resulting indexes are published in updated LA ansible inventories (those generated by the la-toolkit), so in general you can use these indexes without the need to run this repository (that is quite disk and time consumming).

## Dependencies

To run this you'll need to install first: 

- [dopopts](https://github.com/docopt/docopts)
- legacy `nameindexer` playbook executed in the server you'll use this util. For instance `/data/lucene` should exists
- node/npm
- tar
- zip
- mocha for testing

## Usage

Some usage help:

```bash
gbif-taxonomy-for-la --help

Options:
      --backbone                    Download GBIF backbone
      --name-authors                Split name and authors from the GBIF backbone
      --namematching-distri=<nmv>   Download ALA namematching-distribution version [default: 4.2].
      --namematching-index          Generate namematching index
      --namematching-index-legacy   Generate namematching index legacy (pre namemaching-service)
      --dwca                        Regenerate the dwca zip
      --help                        Show help options.
      --version                     Print program version.
```

Download the gbif taxonomy, split `scientificName` and `scientificNameAuthorship`, and generate indexes using a date as file suffix:

```bash
gbif-taxonomy-for-la --backbone --name-authors  --namematching-index --namematching-index-legacy 2022-11-23
```

Just generate the indexes:

```bash
gbif-taxonomy-for-la --namematching-index --namematching-index-legacy 2022-11-23
```

## Tests

Just run `mocha`.

## Contributing

If you detect some extra issue Pull Request welcome.
